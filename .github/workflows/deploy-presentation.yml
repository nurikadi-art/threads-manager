# Deploy AI Avatar Presentation to GitHub Pages (preserving original VA content)
name: Deploy Presentation

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build AI Avatar presentation
        run: npm run build

      - name: Prepare deployment
        run: |
          # Clone the existing gh-pages content
          git clone --branch gh-pages --single-branch https://github.com/${{ github.repository }}.git gh-pages-content || mkdir gh-pages-content

          # Create final deployment directory
          mkdir -p final-deploy

          # Copy existing gh-pages content (original VA presentation)
          if [ -d "gh-pages-content" ]; then
            # Copy everything except .git and presentation folder
            find gh-pages-content -maxdepth 1 -mindepth 1 ! -name '.git' ! -name 'presentation' -exec cp -r {} final-deploy/ \;
          fi

          # Copy new AI Avatar presentation build to /presentation/
          mkdir -p final-deploy/presentation
          cp -r dist/* final-deploy/presentation/

          # Ensure .nojekyll exists
          touch final-deploy/.nojekyll

          # Show what we're deploying
          echo "=== Deployment contents ==="
          ls -la final-deploy/
          echo "=== Presentation folder ==="
          ls -la final-deploy/presentation/

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./final-deploy
          publish_branch: gh-pages
